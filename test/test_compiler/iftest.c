#include "iftest.h"
#include "yats.h"

SETUP_YATS();


static void test_if() {
	unsigned char expected[] = {
		0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_T,
		BRF_8,
		0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_T,
		PRINT,
		HALT
	};
	ASSERT_GEN_BC_EQ(expected, "if true { echo true; };");
}

static void test_ifelse() {
	unsigned char expected[] = {
		0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_T,
		BRF_8,
		0x0B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_T,
		PRINT,
		BR_8,
		0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_F,
		PRINT,
		HALT
	};
	ASSERT_GEN_BC_EQ(expected, "if true { echo true; } else { echo false; };");
}

static void test_ifelseelseif() {
	unsigned char expected[] = {
		0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_T,
		BRF_8,
		0x0B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_T,
		PRINT,
		BR_8,
		0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_F,
		BRF_8,
		0x0B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		BCONST_F,
		PRINT,
		BR_8,
		0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		NCONST,
		PRINT,
		HALT
	};
	ASSERT_GEN_BC_EQ(expected, "if true { echo true; } elseif false { echo false; } else { echo undef; };");
}


int iftest(void) {
	test_if();
	test_ifelse();
	test_ifelseelseif();

	return __YASL_TESTS_FAILED__;
}
